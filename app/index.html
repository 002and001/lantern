<!DOCTYPE html>
<html ng-app="app">
  <head>
    <meta charset="utf-8">
    <title>Lantern Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Lantern Dashboard">
    <meta name="author" content="Team Lantern">

    <link href="lib/bootstrap/css/bootstrap.css" rel="stylesheet">
    <link href="_css/app.css" rel="stylesheet">
    <!--
    <link href="lib/bootstrap/css/bootstrap-responsive.css" rel="stylesheet">
    -->
    <link href="lib/angular-ui/angular-ui.css" rel="stylesheet">
    <link href="lib/select2/select2.css" rel="stylesheet">

    <script src="lib/angular/docs/js/jquery.js"></script>
    <script src="lib/webshims/js-webshim/dev/extras/modernizr-custom.js"></script>
    <script src="lib/webshims/js-webshim/dev/polyfiller.js"></script>
    <script>
      $.webshims.polyfill('forms');
    </script>
    <script src="lib/cometd.js"></script>
    <script src="lib/jquery.cometd.js"></script>
    <script src="lib/angular/angular.js"></script>
    <script src="lib/angular/angular-resource.js"></script>
    <!--
    <script src="lib/angular/i18n/angular-locale_zh-cn.js"></script>
    <script src="lib/angular/i18n/angular-locale_fa-ir.js"></script>
    -->
    <script src="lib/angular-ui/angular-ui.js"></script>
    <script src="lib/select2/select2.js"></script>
    <script src="lib/lodash.js"></script>
    <script src="js/app.js"></script>
    <script src="js/services.js"></script>
    <script src="js/controllers.js"></script>
    <script src="js/filters.js"></script>
    <script src="js/directives.js"></script>
    <script src="js/i18n.js"></script>

    <link rel="shortcut icon" href="img/favicon.ico">
  </head>

  <body ng-controller="RootCtrl" ng-cloak lang="{{ lang() }}" dir="{{ direction() }}">

    <div x-block-input ng-controller="WaitingForLanternCtrl" ng-show="show">
      <!-- ng-hide instead of ui-if so spinner image won't
           be refetched and missing after server goes away -->
      <div id="waiting-container">
        <div>{{ 'WAITING_FOR_LANTERN' | i18n }}</div>
        <img src="lib/webshims/css/polyfill-loader.gif">
      </div>
    </div>

    <!-- modal dialogs -->

    <!--
    <div id="sanity" ng-controller="SanityCtrl" ng-model="show"
         ui-modal class="fade" data-backdrop="static" data-keyboard="false">
      <div class="modal-header">
        <h3>{{ 'UNEXPECTED_STATE_TITLE' | i18n }}</h3>
      </div>
      <div class="modal-body">
        <div>{{ 'UNEXPECTED_STATE_PROMPT' | i18n }}</div>
        <form class="form-inline pagination-centered">
          <label class="checkbox">
            <input type="checkbox" ng-model="notifyLanternDevs">
            {{ 'NOTIFY_LANTERN_DEVS' | i18n }}
          </label>
        </form>
      </div>
      <div class="modal-footer">
        <button ng-click="maybeNotify(); reset()" class="btn btn-danger">{{ 'RESET' | i18n }}</button>
        <button ng-click="maybeNotify(); refresh()" class="btn btn-primary">{{ 'REFRESH' | i18n }}</button>
      </div>
    </div>
    -->

    <div id="settings-unlock" ng-controller="SettingsUnlockCtrl" ui-modal
         ng-model="show" class="fade" data-backdrop="static" data-keyboard="false">
      <form name="unlockForm" ng-submit="settingsUnlock()">
        <div class="modal-header">
          <h3>{{ 'SETTINGS_UNLOCK_TITLE' | i18n }}</h3>
        </div>
        <div class="modal-body">
          <div>{{ 'SETTINGS_UNLOCK_PROMPT' | i18n }}</div>
          <br>
          <div class="control-group" ng-class="{error: error}">
            <div class="controls pagination-centered">
              <div class="input-append">
                <input type="password" ng-model="password" autofocus required
                       name="password" placeholder="{{ 'PASSWORD' | i18n }}">
                <button type="submit" ng-disabled="unlockForm.$invalid"
                        class="btn btn-primary">{{ 'UNLOCK' | i18n }}</button>
              </div>
              <div class="text-error" ui-toggle="error && unlockForm.password.$pristine">
                {{ 'PASSWORD_INVALID' | i18n }}
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>

    <div id="settings-load-failure" ng-controller="SettingsLoadFailureCtrl" ui-modal
         ng-model="show" class="fade" data-backdrop="static" data-keyboard="false">
      <div class="modal-header">
        <h3>{{ 'SETTINGS_LOAD_FAILURE_TITLE' | i18n }}</h3>
      </div>
      <div class="modal-body">
        <div>{{ 'SETTINGS_LOAD_FAILURE_PROMPT' | i18n }}</div>
        <form class="form-inline pagination-centered">
          <label class="checkbox">
            <input type="checkbox" ng-model="notifyLanternDevs">
            {{ 'NOTIFY_LANTERN_DEVS' | i18n }}
          </label>
        </form>
      </div>
      <div class="modal-footer">
        <button ng-click="maybeNotify(); reset()" class="btn btn-danger">{{ 'RESET' | i18n }}</button>
        <button ng-click="maybeNotify(); quit()" class="btn btn-primary">{{ 'QUIT' | i18n }}</button>
      </div>
    </div>

    <!-- setup screens -->

    <div id="password-create" ng-controller="PasswordCreateCtrl" ui-modal
         ng-model="show" class="fade" data-backdrop="static" data-keyboard="false">
      <form name="passwordCreateForm" ng-submit="passwordCreate()">
        <div class="modal-header">
          <h3>{{ 'PASSWORD_CREATE_TITLE' | i18n }}</h3>
        </div>
        <div class="modal-body">
          <div>{{ 'PASSWORD_CREATE_PROMPT' | i18n }}</div>
          <br>
          <div class="control-group pagination-centered" ng-class="{error: passwordCreateForm.password2.$dirty && passwordCreateForm.password2.$invalid}">
            <div class="controls">
              <input type="password" ng-model="password1" autofocus required ng-disabled="disableSubmit"
                     name="password1" placeholder="{{ 'PASSWORD' | i18n }}">
            </div>
            <div class="controls">
              <input type="password" ng-model="password2" name="password2" ng-disabled="disableSubmit"
                     required placeholder="{{ 'PASSWORD_CONFIRM' | i18n }}">
              <div class="text-error" ui-toggle="passwordCreateForm.password2.$dirty && passwordCreateForm.password2.$invalid">{{ 'PASSWORDS_MUST_MATCH' | i18n }}</div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" ng-disabled="passwordCreateForm.$invalid || disableSubmit"
                  class="btn btn-primary">{{ 'CREATE' | i18n }}</button>
        </div>
      </form>
    </div>

    <div id="welcome" ng-controller="WelcomeCtrl" ui-modal ng-model="show"
         class="fade" data-backdrop="static" data-keyboard="false">
      <div class="modal-header pagination-centered">
        <h3>{{ 'WELCOME_TITLE' | i18n }}</h3>
      </div>
      <div class="modal-body pagination-centered">
        <div>{{ 'WELCOME_PROMPT' | i18n }}</div>
      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-success" ng-click="changeSetting('mode', MODE.give)">{{ 'GIVE_ACCESS' | i18n }}</button>
        <button type="submit" class="btn btn-primary" ng-click="changeSetting('mode', MODE.get)">{{ 'GET_ACCESS' | i18n }}</button>
      </div>
    </div>

    <div id="langchooser" ng-controller="LangChooserCtrl" ng-show="show">
      <ul class="pull-right">
        <li ng-class="{active: lang() == 'en'}"><a ng-click="lang() != 'en' && changeSetting('lang', 'en')">English</a></li>
        <li ng-class="{active: lang() == 'zh'}"><a ng-click="lang() != 'zh' && changeSetting('lang', 'zh')">中文</a></li>
        <li ng-class="{active: lang() == 'fa'}"><a ng-click="lang() != 'fa' && changeSetting('lang', 'fa')">‫پارسی‬</a></li>
      </ul>
    </div>

    <!-- XXX use both during initial setup and after (when !passwordSaved)? -->
    <div id="signin" ng-controller="SigninCtrl" ui-modal ng-model="show" class="fade"
         data-backdrop="static" data-keyboard="false">
      <div class="modal-header">
        <h3>{{ 'SIGNIN_TITLE' | i18n }}</h3>
      </div>
      <div class="modal-body">
        <form name="signinForm" class="form-horizontal" ng-submit="signin()">
          <div>{{ 'SIGNIN_PROMPT' | i18n }}</div>
          <br>
          <div class="control-group">
            <label class="control-label">{{ 'GTALK_USERID' | i18n }}</label>
            <div class="controls">
              <input type="email" autofocus required ng-model="userid" ng-disabled="model.settings.userid || disableSubmit"
                     name="userid" placeholder="email@example.com">
             <!--    name="userid" placeholder="{{ 'EMAIL_PLACEHOLDER' | i18n }}"> -->
             <!-- XXX input[type=text] placeholder shim broken when used with Angular expression -->
            </div>
          </div>
          <div class="control-group">
            <label class="control-label">{{ 'GTALK_PASSWORD' | i18n }}</label>
            <div class="controls">
              <input type="password" name="password" ng-model="password" ng-disabled="!needPassword || disableSubmit"
                     ng-required="needPassword" placeholder="{{ needPassword && 'PASSWORD' || 'PASSWORD_SAVED' | i18n }}">
              <a rel="tooltip" data-original-title="{{ 'SIGNIN_TIP_SECURE' | i18n }}" ui-jq="tooltip">
                <i class="icon-lock"></i>
              </a>
            </div>
          </div>
          <div class="control-group">
            <div class="controls">
              <label class="checkbox inline clearfix" style="width: 203px"><!-- XXX -->
                <input type="checkbox" ng-model="savePassword" ng-disabled="disableSubmit"
                       ng-change="changeSetting('savePassword', savePassword)">
                {{ 'SAVE_PASSWORD' | i18n }}
              </label>
              <a rel="tooltip" data-original-title="{{ 'SIGNIN_TIP_SAVE_PASSWORD' | i18n }}" ui-jq="tooltip">
                <i class="icon-info-sign"></i>
              </a>
            </div>
          </div>
          <div class="control-group">
            <div class="controls">
              <div ng-class="{'text-error': signinError}" ui-toggle="showSigninStatus">
                {{ signinStatusKey | i18n }}&nbsp;
              </div>
            </div>
          </div>
          <!-- XXX (hidden) submit input so pressing enter triggers form submission (make this a directive?) -->
          <button type="submit" tabindex="-1" style="height: 0; width: 0; border: 0; filter: progid:DXImageTransform.Microsoft.Alpha(Opacity=0); opacity: 0"></button>
        </form>
      </div>
      <div class="modal-footer">
        <!-- buttons outside the form so reset doesn't get triggered when sign in is disabled on pressing enter -->
        <button type="button" ng-click="reset()" ui-if="!model.setupComplete"
                class="btn btn-danger pull-left">
          <i class="icon-backward icon-white"></i> {{ 'START_OVER' | i18n }}
        </button>
        <button type="submit" ng-click="signin()" class="btn btn-primary"
                ng-disabled="signinForm.$invalid || disableSubmit">
          {{ submitButtonLabelKey | i18n }}
        </button>
      </div>
    </div>

    <div id="gtalkUnreachable" ng-controller="GtalkUnreachableCtrl" ui-modal
         ng-model="show" class="fade" data-backdrop="static" data-keyboard="false">
      <div class="modal-header">
        <h3>{{ 'GTALK_UNREACHABLE_TITLE' | i18n }}</h3>
      </div>
      <div class="modal-body">
        <div>{{ 'GTALK_UNREACHABLE_PROMPT' | i18n }}</div>
      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-success" ng-click="model.modal = MODAL.signin">{{ 'RETRY_NOW' | i18n }}</button>
        <button type="submit" class="btn btn-primary" ng-click="continue_()">{{ 'RETRY_LATER' | i18n }}</button>
      </div>
    </div>

    <div id="sysproxy" ng-controller="SystemProxyCtrl" ui-modal ng-model="show"
         class="fade" data-backdrop="static" data-keyboard="false">
      <div class="modal-header">
        <h3>{{ 'SYSTEM_PROXY_TITLE' | i18n }}</h3>
      </div>
      <div class="modal-body">
        <div>{{ 'SYSTEM_PROXY_PROMPT' | i18n }}</div>
        <br>
        <div class="control-group">
          <div class="controls">
            <label class="radio control-label">
              <input type="radio" ng-model="systemProxy" ng-value="true">
              {{ 'SYSTEM_PROXY_TRUE' | i18n }}
            </label>
          </div>
          <div class="controls">
            <label class="radio control-label">
              <input type="radio" ng-model="systemProxy" ng-value="false">
              {{ 'SYSTEM_PROXY_FALSE' | i18n }}
            </label>
          </div>
        </div>
        <div class="text-error" ui-toggle="sysproxyError">
          {{ 'SYSTEM_PROXY_ERROR' | i18n }}&nbsp;
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" ng-click="reset()" ui-if="!model.setupComplete"
                class="btn btn-danger pull-left">
          <i class="icon-backward icon-white"></i> {{ 'START_OVER' | i18n }}
        </button>
        <button type="submit" class="btn btn-primary" ng-click="sysproxySet()">
          {{ 'CONTINUE' | i18n }}
        </button>
      </div>
    </div>

    <div id="finished" ng-controller="FinishedCtrl" ui-modal
         ng-model="show" class="fade" data-backdrop="static" data-keyboard="false">
      <div class="modal-header">
        <h3>{{ 'FINISHED_TITLE' | i18n }}</h3>
      </div>
      <div class="modal-body pagination-centered">
        <div>{{ 'FINISHED_PROMPT' | i18n }}</div>
        <br>
        <div>
          <small>{{ 'AUTOREPORT_PROMPT' | i18n }}</small>
          <label class="checkbox inline">
            <input type="checkbox" ng-model="notifyLanternDevs"
                   ng-change="changeSetting('autoReport', notifyLanternDevs)">
            <small>{{ 'AUTOREPORT_ENABLE' | i18n }}</small>
          </label>
        </div>
      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-{{ inGetMode && 'primary' || 'success' }}" ng-click="continue_()">{{ 'FINISH' | i18n }}</button>
      </div>
    </div>


    <!-- developer panel -->

    <div id="developer" ng-controller="DevCtrl" ng-show="debug" lang="en" dir="ltr">
      <button class="btn" data-toggle="collapse" data-target="#developer-content">Developer</button>
      <div id="developer-content" class="collapse">
        <label class="checkbox inline">
          Model
          <a href="https://github.com/getlantern/lantern-ui/blob/master/SPECS.md#state-document-specification">(specs)</a>
        </label>
        <label class="checkbox inline"><input type="checkbox" ng-model="prettyPrint"> pretty print</label>
        <pre ui-if="!prettyPrint">{{ model }}</pre>
        <pre ui-if="prettyPrint">{{ model | json }}</pre>
        <div>
          <form class="form-horizontal">
            <div class="control-group">
              <label class="control-label"></label>
              <div class="controls">
                <label class="checkbox"><input type="checkbox" ng-model="model.setupComplete"> setupComplete</label>
              </div>
            </div>
            <div class="control-group">
              <label class="control-label">modal</label>
              <div class="controls">
                <select ui-select2 ng-model="model.modal" data-placeholder="choose value">
                  <option value=""></option>
                  <option value="passwordCreate">passwordCreate</option>
                  <option value="settingsUnlock">settingsUnlock</option>
                  <option value="settingsLoadFailure">settingsLoadFailure</option>
                  <option value="welcome">welcome</option>
                  <option value="signin">signin</option>
                  <option value="gtalkUnreachable">gtalkUnreachable</option>
                  <option value="sysproxy">sysproxy</option>
                  <option value="finished">finished</option>
                </select>
              </div>
            </div>
            <div class="control-group">
              <label class="control-label">settings</label>
              <div class="controls row">
                <div class="span-4">
                  <label>
                    <select ui-select2 ng-model="model.settings.mode" data-placeholder="mode">
                      <option value=""></option>
                      <option value="give">give</option>
                      <option value="get">get</option>
                    </select>
                    mode
                  </label>
                  <label><input type="text" ng-model="model.settings.userid" placeholder="user@example.com"> userid</label>
                  <label><input type="text" placeholder="0" ng-model="model.settings.invites"> invites</label>
                  <label><input type="text" ng-model="model.settings.lang" placeholder="en"> lang</label>
                  <label><input type="text" ng-model="model.settings.proxyPort" placeholder="8787"> proxyPort</label>
                </div>
                <div class="span-4">
                  <label class="checkbox"><input type="checkbox" ng-model="model.settings.systemProxy"> systemProxy</label>
                  <label class="checkbox"><input type="checkbox" ng-model="model.settings.proxyAllSites"> proxyAllSites</label>
                  <label class="checkbox"><input type="checkbox" ng-model="model.settings.savePassword"> savePassword</label>
                  <label class="checkbox"><input type="checkbox" ng-model="model.settings.passwordSaved"> passwordSaved</label>
                  <label class="checkbox"><input type="checkbox" ng-model="model.settings.startAtLogin"> startAtLogin</label>
                  <label class="checkbox"><input type="checkbox" ng-model="model.settings.autoReport"> autoReport</label>
                </div>
                <div class="span-4">
                  <label>proxiedSitesList</label>
                  <textarea placeholder="google.com,twitter.com" ng-model="model.settings.proxiedSitesList"></textarea>
                </div>
              </div>
            </div>
            <div class="control-group">
              <label class="control-label">lang</label>
              <div class="controls">
                <input type="text" ng-model="model.lang" placeholder="en">
              </div>
            </div>
            <div class="control-group">
              <label class="control-label">connectivity</label>
              <div class="controls">
                <label class="checkbox"><input type="checkbox" ng-model="model.connectivity.internet"> internet</label>
                <label><input type="text" ng-model="model.connectivity.gtalk"> gtalk</label>
                <label><input type="text" placeholder="0" ng-model="model.connectivity.peers"> peers</label>
              </div>
            </div>
            <div class="control-group">
              <label class="control-label">version</label>
              <div class="controls">
                <label><input type="text" placeholder="0.20.3-sha1 beta" ng-model="model.version.app"> app</label>
                <label><input type="text" placeholder="[0, 0, 1]" ng-model="model.version.api"> api</label>
              </div>
            </div>
            <div class="control-group">
              <label class="control-label">bytesTransferred</label>
              <div class="controls">
                <label><input type="text" placeholder="0" ng-model="model.bytesTransferred.current.up"> current.up</label>
                <label><input type="text" placeholder="0" ng-model="model.bytesTransferred.current.dn"> current.dn</label>
                <label><input type="text" placeholder="0" ng-model="model.bytesTransferred.lifetime.up"> lifetime.up</label>
                <label><input type="text" placeholder="0" ng-model="model.bytesTransferred.lifetime.dn"> lifetime.dn</label>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>

    <script src="lib/bootstrap/js/bootstrap.js"></script>
  </body>
</html>
