<html>
  <head>
    <meta charset=utf-8 />
    <script src="/org/cometd.js"></script>
    <script src="https://raw.github.com/cometd/cometd/master/cometd-javascript/jquery/src/main/webapp/jquery/jquery-1.6.4.js"></script>
    <script src="https://raw.github.com/cometd/cometd/master/cometd-javascript/jquery/src/main/webapp/jquery/jquery.cometd.js"></script>
    <script src="https://raw.github.com/cometd/cometd/master/cometd-javascript/jquery/src/main/webapp/jquery/json2.js"></script>
    <script src="http://docs-next.angularjs.org/angular-0.10.5.min.js" ng:autobind></script>
    <script>
      function Ctrl() {
        var self = this;
        self.state = null;
        self.$watch('state');
        self.update = function(data){
          self.state = data;
          self.$digest();
        };
      }

      $(document).ready(function(){
        $.cometd.configure({
          url: location.protocol + "//" + location.host + '/cometd'
        });
        $.cometd.addListener('/meta/handshake', function(handshake){
          if(handshake.successful === true){
            $.cometd.batch(function(){
              $.cometd.subscribe('/sync', function(msg){
                $('body').scope().update(msg.data);
              });
            });
          }
        });
        $.cometd.handshake();
      });

      $(window).unload(function(){
        $.cometd.disconnect(true);
      });
    </script>
  </head>

  <body ng:controller="Ctrl">
    <ul>
      <li><label><input type=checkbox ng:model=state.startAtLogin /> Start at login</label></li>
      <li><label><input type=checkbox ng:model=state.connectOnLaunch /> Connect on launch</label></li>
    </ul>
    <table>
      <tr ng:repeat="entry in state.whitelist.entries">
        <td>
          <form>
            <input placeholder="Update entry" value="{{entry.site}}" required />
          </form>
        </td>
        <td>
          <form>
            <a>[x]</a>
          </form>
        </td>
      </tr>
      <tr colspan=2>
        <td>
          <form>
            <input placeholder="Add a new entry" required />
          </form>
        </td>
      </tr>
    </table>
    <hr/>
    <div>
      <label><input type=checkbox ng:model=showstate /> Show state</label>
      <pre ng:show=showstate>{{state}}</pre>
    </div>
  </body>
</html>