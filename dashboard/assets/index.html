<!doctype html>
<html xmlns:ng=http://angularjs.org>
  <head>
    <meta charset=utf-8 />
    <meta http-equiv=X-UA-Compatible content=IE=edge,chrome=1>
    <meta name=viewport content="width=device-width, initial-scale=1.0">
    <title>Lantern Dashboard</title>
    <link rel=stylesheet href=css/style.css />
    <link rel=stylesheet href=css/lib/lionbars.css />
    <script src=js/lib/jquery-1.7.1.min.js></script>
    <script src=js/lib/jquery.lionbars.0.3.min.js></script>
    <script src=js/lib/json2.js></script>
    <script src=js/lib/cometd.js></script>
    <script src=js/lib/jquery.cometd.js></script>
    <script src=js/lib/angular-0.10.5.min.js ng:autobind></script>
    <script src=js/dashboard.js></script>
  </head>
  <body ng:controller=LDCtrl lang=en>
    <div id=block-overlay ng:class="block && 'block-enabled'"></div>
    <div id=ld-container style="display: none" ng:show=stateloaded() ng:class="!state.initialSetupComplete && 'welcome' || ''">
      <div id=welcome-container ng:show=!state.initialSetupComplete>
        <div id=welcome class="slide selected" data-cls=slide>
          <h1>Welcome to Lantern</h1>
          <h4>Internet freedom for everyone.</h4>
          <div class=controls>
            <figure>
              <a href=#mode><img src=img/arrow-right.png alt=Continue /></a>
              <figcaption>Continue</figcaption>
            </figure>
          </div>
        </div>
        <div id=mode class=slide data-cls=slide>
          <h1>Use Lantern to</h1>
          <ul class=welcome-optionlist>
            <li><label><input type=radio value={{true}} ng:change=switchmode() ng:model=state.getMode /> Get access through others’ connections</label></li>
            <li><label><input type=radio value={{false}} ng:change=switchmode() ng:model=state.getMode /> Give access to others through my connection</label></li>
          </ul>
          <div class=controls>
            <figure class=left>
              <a href=#welcome><img src=img/arrow-left.png alt=Back /></a>
              <figcaption>Back</figcaption>
            </figure>
            <figure class=right>
              <a href=#signin><img src=img/arrow-right.png alt=Continue /></a>
              <figcaption>Continue</figcaption>
            </figure>
          </div>
        </div>
        <div id=signin class=slide data-cls=slide>
          <h1>Sign into Google</h1>
          <p>Lantern uses Google to connect to other users.</p>
          <form id=firstsignin-form name=fsform class=signin ng:submit=fs_submit()>
            <ul>
              <li><div class=error>Bad username or password.</div></li>
              <li><input type=text placeholder=email@example.com ng:model=inputemail value="{{state.email || ''}}" required autofocus /></li>
              <li><input type=password placeholder={{passplaceholder()}} ng:model=inputpassword ng:required={{passrequired()}} title="This form is sent securely." /></li>
              <li><label><input type=checkbox ng:model=state.savePassword ng:change=toggle('savePassword') /> Save password</label></li>
            </ul>
            <div class=controls>
              <figure class=left>
                <a href=#mode><img src=img/arrow-left.png alt=Back /></a>
                <figcaption>Back</figcaption>
              </figure>
              <figure class=right>
                <input id=fs-submit type=image ng:src={{fs_submit_src()}} alt=Continue ng:disabled="{{loggedout() && fsform.$invalid}}" />
                <figcaption>Continue</figcaption>
              </figure>
            </div>
          </form>
        </div>
        <div id=trustedpeers class=slide data-cls=slide>
          <h1>Trusted Peers</h1>
          <h4>Choose people you would trust to proxy any <a class=doc href=https://github.com/getlantern/lantern/wiki/HTTP-and-Trusted-Peers target=_blank>unencrypted traffic</a>.</h4>
          <input class=searchpeers type=search ng:model=peerfilterinput placeholder="Search by name or email" results=0 incremental autosave/>
          <ul class="peerlist lionbars">
            <li ng:show="peers == FETCHING">Loading...</li>
            <li ng:show="peers != FETCHING && !peers.$filter(peerfilter).length">No {{peerfilterinput && 'matching' || 'available'}} contacts</li>
            <li ng:show="peers != FETCHING" ng:repeat="peer in peers.$filter(peerfilter)">
              <label><input type=checkbox ng:model=peer.trusted ng:change=toggleTrusted(peer) /> {{peer.name || peer.email}}</label>
            </li>
          </ul>
          <span class=smallnote><a class=doc href=https://github.com/getlantern/lantern/wiki/Lantern-Cloud-Proxies target=_blank>Lantern cloud proxies</a> will be used when no trusted peers are available.</span>
          <div class=controls>
            <figure class=left>
              <a href=#signin><img src=img/arrow-left.png alt=Back /></a>
              <figcaption>Back</figcaption>
            </figure>
            <figure class=right>
              <a href=#systemproxy><img src=img/arrow-right.png alt=Continue /></a>
              <figcaption>Continue</figcaption>
            </figure>
          </div>
        </div>
        <div id=systemproxy class=slide data-cls=slide>
          <h1>System Proxy</h1>
          <ul class=welcome-optionlist>
            <li><div class=error>Proxy configuration failed.</div></li>
            <li><label><input type=radio value={{true}} ng:change=toggle('systemProxy') ng:model=state.systemProxy /> Set Lantern as my system proxy (recommended)</label><div class=smallnote>Your browser should start using Lantern automatically</div></li>
            <li><label><input type=radio value={{false}} ng:change=toggle('systemProxy') ng:model=state.systemProxy /> I will <a class=doc href=https://github.com/getlantern/lantern/wiki/Manual-Proxy-Configuration target=_blank>manually configure</a> my browser to use Lantern</label></li>
          </ul>
          <div class=controls>
            <figure class=left>
              <a href=#trustedpeers><img src=img/arrow-left.png alt=Back /></a>
              <figcaption>Back</figcaption>
            </figure>
            <figure class=right>
              <a ng:click=init_applyautoproxy()><img ng:class="['togglespinner', state.connectivity]" ng:src={{autoproxy_continue_src()}} alt=Continue /></a>
              <figcaption>Continue</figcaption>
            </figure>
          </div>
        </div>
        <div id=done class=slide data-cls=slide>
          <h1>Finished</h1>
          <h4>Thank you for joining Lantern.</h4>
          <p class=smallnote>
            You are one of a handful of trusted testers with early access to Lantern.<br/>
            With your feedback, Lantern can improve until it’s ready for global access.<br/>
            In the meantime, thanks for helping to keep the circle small and the turnaround fast.<br/>
          </p>
          <div class=controls>
            <figure class=left>
              <a href="{{state.getMode && '#systemproxy' || '#signin'}}"><img src=img/arrow-left.png alt=Back /></a>
              <figcaption>Back</figcaption>
            </figure>
            <figure class=right>
              <a ng:click=finishsetup()><img src=img/arrow-right.png alt=Finish /></a>
              <figcaption>Finish</figcaption>
            </figure>
          </div>
        </div>
      </div>
      <div id=dashboard ng:show=state.initialSetupComplete>
        <div id=topbar>
          <span id=topbar-conn ng:class="['iconlabel', state.connectivity, state.getMode && 'get' || 'give']"><span class="iconlabel-icon connlight"></span><span class=iconlabel-label>{{conncaption()}}</span></span>
          <span ng:show=loggedin()>
            <span id=topbar-peers class=topbar-stat>{{npeers()}} <ng:pluralize count=npeers() when="{'1': 'peer', 'other': 'peers'}"></ng:pluralize></span>
            <span id=topbar-rate-up class="topbar-stat rate">
              <img src=img/topbar-arrow-up.png alt="upload rate" />
              {{bytesrate(state.upRate, false, updnrate())}}
            </span>
            <span id=topbar-rate-dn class="topbar-stat rate">
              <img src=img/topbar-arrow-dn.png alt="download rate" />
              {{bytesrate(state.downRate, false, updnrate())}}
            </span>
          </span>
          <a ng:show=state.email id=userlink class="collapsed">{{state.email}}</a>
        </div>
        <div id=usermenu class={{state.connectivity}}>
          <ul>
            <li ng:show=loggedin()><a ng:click=switchmode(true)>{{switchlinktext()}}</a></li>
            <li><a ng:click="showsignin(true)">{{loggedin() && 'Switch user' || 'Sign in'}}</a></li>
            <li ng:show=loggedin()><a ng:click=signout()>Sign out</a></li>
          </ul>
        </div>
        <div id=sidebar>
          <h1>Dashboard</h1>
          <nav>
            <ul id=panel-list>
              <li><a href=#status class=selected>Status</a></li>
              <li><a href=#hood>Under the Hood</a></li>
              <li><a href=#contact>Contact</a></li>
              <li><a href=#update ng:show=updateavailable() id=sidebar-update-link>Update</a></li>
            </ul>
          </nav>
        </div>
        <div class="panel selected" id=status data-cls=panel>
          <h1>Status</h1>
          <dl>
            <dt>Connection</dt>
            <dd>
              <span ng:class="['iconlabel', state.connectivity, state.getMode && 'get' || 'give']"><span class="iconlabel-icon connlight"></span><span class=iconlabel-label>{{conncaption()}}
              <a class=actionlink ng:click="!(state.savePassword && state.passwordSaved) && showsignin(true) || signin()" ng:show=loggedout()>Sign in</a></span>
              </span>
            </dd>
            <dt ng:show=loggedin()>Transfers</dt>
            <dd ng:show=loggedin()>
            <div>{{bytesrate(updnrate())}} currently<span ng:show=npeers()> via {{npeers()}} <ng:pluralize count=npeers() when="{'1': 'peer', 'other': 'peers'}"></ng:pluralize></span></div>
              <div>{{prettybytes(state.upTotalLifetime + state.downTotalLifetime)}} lifetime</div>
            </dd>
            <dt>Version</dt>
            <dd>
              {{state.version == 'lantern_version_tok' && '(development)' || 'Lantern ' + state.version + ' beta'}}
              <a href=#update ng:show=updateavailable() id=update-avail-link class="actionlink panellink">Update available</a>
            </dd>
          </dl>
        </div>
        <div class=panel id=hood data-cls=panel>
          <h1>Under the Hood</h1>
          <dl>
            <dt>Port</dt>
            <dd>
              <input type=text value={{state.port}} id=port min=1024 max=65535 readonly />
            </dd>
            <dt ng:show=state.getMode>Policy</dt>
            <dd ng:show=state.getMode>
              <ul>
                <li>
                  <label>
                    <input type=radio value={{true}} ng:change=toggle('proxyAllSites') ng:model=state.proxyAllSites />
                    Proxy all sites
                  </label>
                </li>
                <li>
                  <label>
                    <input type=radio value={{false}} ng:change=toggle('proxyAllSites') ng:model=state.proxyAllSites />
                    Only proxy certain sites
                  </label>
                  <a class="overlaylink actionlink" ng:show=!state.proxyAllSites href=#proxiedsites>Manage proxied sites...</a>
                </li>
                <li>
                  <a class="overlaylink buttonlink" id=manage-trusted-link href=#trusted>Manage trusted peers...</a>
                </li>
              </ul>
            </dd>
            <dt>Application</dt>
            <dd>
              <ul>
                <li><label><input type=checkbox ng:change=toggle('startAtLogin') ng:model=state.startAtLogin /> Launch on system startup</label></li>
                <li><label><input type=checkbox ng:change=toggle('connectOnLaunch') ng:model=state.connectOnLaunch /> Sign in on launch</label></li>
                <li ng:show=state.getMode><label><input type=checkbox ng:change=toggle('systemProxy') ng:model=state.systemProxy /> Set as system proxy</label></li>
              </ul>
              <input type=button id=reset-button ng:click=reset() value="Reset Lantern" />
            </dd>
          </dl>
        </div>
        <div class=panel id=contact data-cls=panel>
          <h1>Contact</h1>
          <p id=contact-msg>
            The collaborative <a href=https://github.com/getlantern/lantern/wiki/
            target=_blank>Lantern Reference</a> and the
            <a href="https://groups.google.com/forum/#!forum/lantern-users-en"
            target=_blank>Lantern Users Forum</a> are good places to search,
            request, and provide information appropriate for public access.
            Sensitive communication can be submitted securely through the
            form below.
          </p>
          <textarea ng:model=pm id=pm-textarea class=lionbars placeholder="Private message to Lantern developers" title="This form is sent securely."></textarea>
          <div id=pm-controls>
            <!--
            <label><input type=checkbox ng:model=requestreply /> please reply to</label>
            <input id=pm-replyto type=email ng:model=requestreplyto ng:disabled={{!requestreply}} placeholder=email@example.com value={{state.email}} />
            -->
            <span ng:show=loggedout() class=extra>
              <a class=actionlink ng:click="!(state.savePassword && state.passwordSaved) && showsignin(true) || signin()">Sign in</a>
              to send feedback
            </span>
            <button id=pm-send class=buttonlink ng:disabled="{{!loggedin() || !pm}}" ng:click=sendpm()>Send</button>
          </div>
          <!--
          <div class=extra ng:show=requestreply>
            Only request replies to secure email accounts.
          </div>
          -->
        </div>
        <div class=panel id=update data-cls=panel>
          <h1>Update</h1>
          <p ng:show=!updateavailable()>
            No updates available at this time.
          </p>
          <p ng:show=updateavailable()>
            A new version of Lantern is available!
            <a class=buttonlink href={{state.update.url}} target="_blank">Download now</a>
          </p>
          <dl ng:show=updateavailable()>
            <dt>Version</dt>
            <dd>{{state.update.number}}</dd>
            <dt>Released</dt>
            <dd><time title={{state.update.released}} datetime={{state.update.released}}>{{state.update.released | date}}</time></dd>
          </dl>
          <div>
            <a class=overlaylink href=#changelog title=https://raw.github.com/getlantern/lantern/master/CHANGES.rst>Changelog</a>
          </div>
        </div>

        <div id=signin-overlay ng:show=showsignin()>
          <a class=close ng:click="showsignin(false)">×</a>
          <form name=signinform class=signin ng:submit=signin(inputemail)>
            <ul>
              <li><div class=error>Bad username or password.</div></li>
              <li><input type=text placeholder=email@example.com ng:model=inputemail value="{{state.email || ''}}" required /></li>
              <li><input type=password placeholder={{passplaceholder()}} ng:model=inputpassword ng:required={{passrequired()}} title="This form is sent securely." /></li>
              <li><label><input type=checkbox ng:model=state.savePassword ng:change=toggle('savePassword') /> Save password</label></li>
            </ul>
            <button ng:show=!loggingin() type=submit ng:disabled="{{(loggedin() && sameuser() && !inputpassword) || (passrequired() && !inputpassword)}}" >Sign in</button>
            <img class=spinner src=img/spinner-big.gif alt="Signing in..." ng:show=loggingin() />
          </form>
        </div>

        <div class=overlay id=proxiedsites data-cls=overlay>
          <a class=close>×</a>
          <h1>Proxied sites</h1>
          <ul id=siteslist class=lionbars>
            <li id=sitetoadd-li>
              <form ng:submit="updatewhitelist(sitetoadd, true)"><input id=sitetoadd ng:model=sitetoadd type=text required placeholder="Add a new site" ng:pattern=/^([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,6}$/ /></form>
            </li>
            <li ng:repeat="entry in whitelist.$orderBy(['required', 'site'])">
              <span ng:class="[!entry.required && 'hidden', 'smallnote', 'disabled']">✽</span>
              <form ng:submit="!entry.required && updatewhitelist(entry.site, newsite)"><input class=whitelistentry ng:model=newsite type=text placeholder=example.com value={{entry.site}} required ng:readonly={{entry.required}} ng:pattern=/^([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,6}$/ /></form>
              <a class=delete ng:show=!entry.required ng:click="updatewhitelist(entry.site, false)">×</a>
            </li>
          </ul>
          <div id=required-legend><span class=smallnote>✽</span> required</div>
        </div>

        <div class=overlay data-cls=overlay id=trusted>
          <a class=close>×</a>
          <h1>Trusted peers</h1>
          <h4>Contacts you would trust to proxy <a class=doc href=https://github.com/getlantern/lantern/wiki/HTTP-and-Trusted-Peers target=_blank>unencrypted traffic</a></h4>
          <input class=searchpeers type=search ng:model=peerfilterinput placeholder="Search by name or email" results=0 incremental autosave/>
          <ul class="peerlist lionbars">
            <li ng:show="peers == FETCHING">Loading...</li>
            <li ng:show="peers != FETCHING && !peers.$filter(peerfilter).length">No {{peerfilterinput && 'matching' || 'available'}} contacts</li>
            <li ng:show="peers != FETCHING" ng:repeat="peer in peers.$filter(peerfilter)">
              <label><input type=checkbox ng:model=peer.trusted ng:change=toggleTrusted(peer) /> {{peer.name || peer.email}}</label>
            </li>
          </ul>
          <div class=smallnote><a class=doc href=https://github.com/getlantern/lantern/wiki/Lantern-Cloud-Proxies target=_blank>Lantern cloud proxies</a> will be used when no trusted peers are available.</div>
        </div>

        <div class=overlay data-cls=overlay id=changelog>
          <a class=close>×</a>
          <iframe id=changelog-frame src=http://api.rst2a.com/1.0/rst2/html?style=lsr&uri=https://raw.github.com/getlantern/lantern/master/CHANGES.rst></iframe>
        </div>

        <div class="flashmsg tip" id=tip-trayicon>
          <a class=close>×</a>
          <span class=content>
            Tip: Look for the
            <img src=img/16on.png alt="Lantern connected icon" />
            icon in your {{iconloctxt()}} when you need to find Lantern.
          </span>
        </div>

        <div class=flashmsg id=flash-main>
          <a class=close>×</a>
          <span class=content></span>
        </div>

      </div>
    </div>
  </body>
</html>
